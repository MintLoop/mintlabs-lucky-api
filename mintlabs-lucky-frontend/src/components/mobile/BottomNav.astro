---
/**
 * BottomNav.astro
 * Mobile bottom navigation bar for Lucky Numbers utility-app pattern.
 * 
 * Architecture: Phase 4.5 mobile-first UX
 * Spec: docs/LUCKY/WORKFLOWS/mobile-ux.md
 * 
 * Requirements:
 * - ‚â•44px tap targets (Apple HIG)
 * - semantic <nav> with aria-label
 * - 5 tabs: Numbers, Tools, Budget, Casino, Profile
 * - Active state indication via aria-current and visual highlight
 * - Fixed to viewport bottom on mobile
 * - Hidden on desktop (md: breakpoint)
 */

interface Props {
  /** Current active tab - determines which icon gets highlighted */
  activeTab?: 'numbers' | 'tools' | 'budget' | 'casino' | 'profile';
}

const { activeTab = 'numbers' } = Astro.props;

// Tab definitions - single source of truth for bottom nav
const tabs = [
  {
    id: 'numbers',
    label: 'Numbers',
    href: '/',
    icon: 'üé≤', // Primary RNG action
  },
  {
    id: 'tools',
    label: 'Tools',
    href: '/tools',
    icon: 'üß∞',
  },
  {
    id: 'budget',
    label: 'Budget',
    href: '/budget',
    icon: 'üí∞',
  },
  {
    id: 'casino',
    label: 'Casino',
    href: '/casino-lite',
    icon: 'üÉè',
  },
  {
    id: 'profile',
    label: 'Profile',
    href: '/lucky-profile',
    icon: 'üë§',
  },
] as const;
---

<nav 
  class="bottom-nav" 
  aria-label="Main navigation"
  role="navigation"
>
  <ul class="bottom-nav__list">
    {tabs.map((tab) => {
      const isActive = tab.id === activeTab;
      return (
        <li class="bottom-nav__item">
          <a 
            href={tab.href}
            class:list={[
              'bottom-nav__link',
              { 'bottom-nav__link--active': isActive }
            ]}
            aria-current={isActive ? 'page' : undefined}
          >
            <span class="bottom-nav__icon" aria-hidden="true">
              {tab.icon}
            </span>
            <span class="bottom-nav__label">
              {tab.label}
            </span>
          </a>
        </li>
      );
    })}
  </ul>
</nav>

<style>
  /* Bottom Navigation - Mobile Utility Pattern */
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: var(--z-nav, 100);
    
    /* Visual treatment */
    background: var(--color-surface, #ffffff);
    border-top: 1px solid var(--color-border, #e5e5e5);
    
    /* Safe area for notched devices */
    padding-bottom: env(safe-area-inset-bottom, 0);
    
    /* Shadow for depth */
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08);
  }
  
  .bottom-nav__list {
    display: flex;
    justify-content: space-around;
    align-items: stretch;
    list-style: none;
    margin: 0;
    padding: 0;
    max-width: 500px;
    margin-inline: auto;
  }
  
  .bottom-nav__item {
    flex: 1;
    display: flex;
  }
  
  .bottom-nav__link {
    /* Tap target: minimum 44px (Apple HIG) */
    min-height: 56px;
    min-width: 44px;
    
    /* Layout */
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    
    /* Spacing */
    padding: 8px 4px;
    
    /* Typography */
    text-decoration: none;
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.01em;
    
    /* Color - inactive state */
    color: var(--color-text-muted, #6b7280);
    
    /* Transition */
    transition: color 0.15s ease, transform 0.1s ease;
    
    /* Touch feedback */
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
  
  .bottom-nav__link:hover {
    color: var(--color-text, #1f2937);
  }
  
  .bottom-nav__link:active {
    transform: scale(0.95);
  }
  
  /* Active state */
  .bottom-nav__link--active {
    color: var(--color-primary, #6366f1);
    font-weight: 600;
  }
  
  .bottom-nav__link--active .bottom-nav__icon {
    transform: scale(1.1);
  }
  
  .bottom-nav__icon {
    font-size: 24px;
    line-height: 1;
    transition: transform 0.15s ease;
  }
  
  .bottom-nav__label {
    line-height: 1;
    white-space: nowrap;
  }
  
  /* Hide on desktop - show full navigation instead */
  @media (min-width: 768px) {
    .bottom-nav {
      display: none;
    }
  }
  
  /* Reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .bottom-nav__link {
      transition: none;
    }
    
    .bottom-nav__link:active {
      transform: none;
    }
    
    .bottom-nav__icon {
      transition: none;
    }
  }
  
  /* Dark mode support via theme tokens */
  :global([data-theme="dark"]) .bottom-nav {
    background: var(--color-surface-dark, #1f2937);
    border-top-color: var(--color-border-dark, #374151);
  }
  
  :global([data-theme="dark"]) .bottom-nav__link {
    color: var(--color-text-muted-dark, #9ca3af);
  }
  
  :global([data-theme="dark"]) .bottom-nav__link:hover,
  :global([data-theme="dark"]) .bottom-nav__link--active {
    color: var(--color-primary-light, #818cf8);
  }
</style>

<script>
  /**
   * Client-side enhancement for bottom nav
   * - Handles active state based on current URL (for SPAs)
   * - Adds haptic feedback where available
   */
  
  // Optional: Update active state on client navigation
  function updateActiveTab() {
    const path = window.location.pathname;
    const links = document.querySelectorAll('.bottom-nav__link');
    
    links.forEach((link) => {
      const href = link.getAttribute('href');
      const isActive = href === '/' 
        ? path === '/' 
        : path.startsWith(href || '');
      
      link.classList.toggle('bottom-nav__link--active', isActive);
      
      if (isActive) {
        link.setAttribute('aria-current', 'page');
      } else {
        link.removeAttribute('aria-current');
      }
    });
  }
  
  // Listen for View Transitions (Astro SPA mode)
  document.addEventListener('astro:page-load', updateActiveTab);
  
  // Optional: Haptic feedback on tap (iOS Safari)
  document.querySelectorAll('.bottom-nav__link').forEach((link) => {
    link.addEventListener('click', () => {
      if ('vibrate' in navigator) {
        navigator.vibrate(10);
      }
    });
  });
</script>
