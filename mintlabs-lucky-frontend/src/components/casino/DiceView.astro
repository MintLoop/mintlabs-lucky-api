---
// DiceView Component - Casino-Style D6 Renderer with Animation
// Phase 4.3 - Casino-Lite Dice System

interface Props {
  value: number; // 1-6
  isRolling?: boolean;
  size?: 'sm' | 'md' | 'lg';
  class?: string;
}

const { value, isRolling = false, size = 'md', class: className = '' } = Astro.props;

// Size mappings
const sizeClasses = {
  sm: 'w-12 h-12',
  md: 'w-16 h-16',
  lg: 'w-24 h-24',
};

const pipSizeClasses = {
  sm: 'w-1.5 h-1.5',
  md: 'w-2 h-2',
  lg: 'w-3 h-3',
};

// Pip layouts for each face (1-6)
const pipLayouts: Record<number, string[]> = {
  1: ['center'],
  2: ['top-left', 'bottom-right'],
  3: ['top-left', 'center', 'bottom-right'],
  4: ['top-left', 'top-right', 'bottom-left', 'bottom-right'],
  5: ['top-left', 'top-right', 'center', 'bottom-left', 'bottom-right'],
  6: ['top-left', 'top-right', 'middle-left', 'middle-right', 'bottom-left', 'bottom-right'],
};

const pips = pipLayouts[value] || [];
---

<div
  class={`dice-view ${sizeClasses[size]} ${className} ${isRolling ? 'rolling' : ''}`}
  role="img"
  aria-label={`Dice showing ${value}`}
>
  <div class="dice-face">
    {pips.map((position) => (
      <div class={`pip ${position} ${pipSizeClasses[size]}`}></div>
    ))}
  </div>
</div>

<style>
  .dice-view {
    position: relative;
    border-radius: 12%;
    background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
    border: 2px solid rgba(0, 0, 0, 0.15);
    box-shadow: 
      0 2px 4px rgba(0, 0, 0, 0.1),
      inset 0 1px 2px rgba(255, 255, 255, 0.8),
      inset 0 -1px 2px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
  }

  .dice-view:hover {
    transform: scale(1.05);
  }

  .dice-face {
    position: relative;
    width: 100%;
    height: 100%;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-rows: 1fr 1fr 1fr;
    padding: 12%;
    gap: 8%;
  }

  .pip {
    background: #1a1a1a;
    border-radius: 50%;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.3);
    position: absolute;
  }

  /* Pip positioning */
  .pip.center {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .pip.top-left {
    top: 15%;
    left: 15%;
  }

  .pip.top-right {
    top: 15%;
    right: 15%;
  }

  .pip.middle-left {
    top: 50%;
    left: 15%;
    transform: translateY(-50%);
  }

  .pip.middle-right {
    top: 50%;
    right: 15%;
    transform: translateY(-50%);
  }

  .pip.bottom-left {
    bottom: 15%;
    left: 15%;
  }

  .pip.bottom-right {
    bottom: 15%;
    right: 15%;
  }

  /* Rolling animation */
  .dice-view.rolling {
    animation: dice-shake 0.5s ease-in-out;
  }

  @keyframes dice-shake {
    0%, 100% {
      transform: rotate(0deg);
    }
    10% {
      transform: rotate(-10deg) translateX(-2px);
    }
    20% {
      transform: rotate(10deg) translateX(2px);
    }
    30% {
      transform: rotate(-8deg) translateY(-2px);
    }
    40% {
      transform: rotate(8deg) translateY(2px);
    }
    50% {
      transform: rotate(-5deg) translateX(-1px);
    }
    60% {
      transform: rotate(5deg) translateX(1px);
    }
    70% {
      transform: rotate(-3deg) translateY(-1px);
    }
    80% {
      transform: rotate(3deg) translateY(1px);
    }
    90% {
      transform: rotate(-1deg);
    }
  }

  /* Pip shuffle animation (when rolling) */
  .rolling .pip {
    animation: pip-blink 0.1s infinite;
  }

  @keyframes pip-blink {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.3;
    }
  }
</style>
