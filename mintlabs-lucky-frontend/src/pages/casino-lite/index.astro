---
/**
 * Casino-Lite Hub - Central index for all casino simulators
 * SEO-optimized landing page with game categories
 * Structure mirrors /tools hub for consistency
 */
import Layout from '../../layouts/Layout.astro';
import HubSearch from '../../components/HubSearch.astro';
import ThemeSelector from '../../components/ThemeSelector.astro';
import { HOME_CASINO_FEATURED, CASINO_GROUPS } from '../../data/hubs';
import '../../styles/hub.css';

// CatnipCoin constants (mirrored from utils for SSR)
const CATNIP_STARTING_BALANCE = 1000;
---

<Layout
  title="Casino-Lite Simulators | MintLabs Lucky Numbers"
  description="Free casino game simulators for learning probability and strategy. Play Blackjack, War, Coin Flip, and more. No real money, no risk ‚Äî pure education and entertainment."
>
  <main class="mx-auto max-w-3xl px-4 sm:px-6 py-8">
    <!-- Top bar: Breadcrumb + Theme -->
    <div class="flex items-center justify-between mb-6">
      <nav class="text-sm" aria-label="Breadcrumb">
        <ol class="flex items-center gap-2 theme-text-muted">
          <li><a href="/" class="hover:text-[var(--accent-primary)] transition-colors">Home</a></li>
          <li><span class="opacity-50">/</span></li>
          <li class="theme-text-primary font-medium">Casino-Lite</li>
        </ol>
      </nav>
      <ThemeSelector id="casinoThemeSelect" />
    </div>

    <!-- Hero -->
    <header class="mb-6">
      <h1 class="text-3xl md:text-4xl font-bold theme-text-primary mb-3">
        üé∞ Casino-Lite Simulators
      </h1>
      <p class="theme-text-secondary text-base leading-relaxed">
        Learn probability and strategy through free casino game simulators.
      </p>
    </header>

    <!-- Search -->
    <div class="mb-8">
      <HubSearch placeholder="Search games..." hubType="casino" />
    </div>

    <!-- Featured Games -->
    <section class="mb-10">
      <h2 class="text-xl font-semibold theme-text-primary mb-4 flex items-center gap-2">
        <span>üåü</span> Popular Games
      </h2>
      <div class="grid gap-3 sm:grid-cols-2">
        {HOME_CASINO_FEATURED.map((game) => (
          <a href={game.href} class="hub-card hub-card--featured">
            <span class="hub-card-icon">{game.icon}</span>
            <div class="hub-card-content">
              <span class="hub-card-title">{game.title}</span>
              <span class="hub-card-desc">{game.description}</span>
            </div>
            <span class="hub-card-arrow">‚Üí</span>
          </a>
        ))}
      </div>
    </section>

    <!-- Game Groups -->
    {CASINO_GROUPS.map((group) => (
      <section class="mb-8">
        <h2 class="text-lg font-semibold theme-text-primary mb-3">{group.name}</h2>
        <div class="grid gap-2 sm:grid-cols-2">
          {group.items.map((game) => (
            <a href={game.href} class="hub-card">
              <span class="hub-card-icon">{game.icon}</span>
              <div class="hub-card-content">
                <span class="hub-card-title">{game.title}</span>
                <span class="hub-card-desc">{game.description}</span>
              </div>
              <span class="hub-card-arrow">‚Üí</span>
            </a>
          ))}
        </div>
      </section>
    ))}

    <!-- MintyCatnipCoin Info Box -->
    <section class="hub-info-box mb-8">
      <div class="flex items-start gap-3">
        <span class="text-2xl">üê±</span>
        <div class="flex-1">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-base font-semibold theme-text-primary">MintyCatnipCoin</h2>
            <span id="catnipBalanceDisplay" class="text-sm font-mono theme-text-secondary">
              ü™ô <span id="balanceValue">{CATNIP_STARTING_BALANCE}</span> MCC
            </span>
          </div>
          <p class="theme-text-secondary text-sm mb-3">
            Our games use MintyCatnipCoin (MCC) ‚Äî a fictional currency with zero real-world value.
            Start with {CATNIP_STARTING_BALANCE.toLocaleString()} MCC and play risk-free.
          </p>
          <div class="flex flex-wrap gap-2">
            <button
              id="resetBalanceBtn"
              class="text-xs px-3 py-1.5 rounded-full border transition-colors"
              style="border-color: var(--border-primary); color: var(--text-muted);"
            >
              Reset to {CATNIP_STARTING_BALANCE.toLocaleString()}
            </button>
            <button
              id="customBalanceBtn"
              class="text-xs px-3 py-1.5 rounded-full border transition-colors"
              style="border-color: var(--border-primary); color: var(--text-muted);"
            >
              Set Custom Amount
            </button>
          </div>
          <p class="text-xs theme-text-muted mt-3">
            MCC cannot be exchanged, purchased, or converted to real money.
          </p>
        </div>
      </div>
    </section>

    <!-- Trust Badges -->
    <div class="flex flex-wrap gap-2 mb-8">
      <span class="hub-badge">‚úÖ 100% Free</span>
      <span class="hub-badge">üé≤ Fair RNG</span>
      <span class="hub-badge">üìö Educational</span>
      <span class="hub-badge">üîí No Account</span>
    </div>

    <!-- Cross-links -->
    <section class="mt-12 pt-8 border-t border-[var(--border-primary)]">
      <h2 class="text-lg font-semibold theme-text-primary mb-4">Explore More</h2>
      <div class="flex flex-wrap gap-3">
        <a href="/" class="hub-link">
          <span>üçÄ</span> Generate Numbers
        </a>
        <a href="/tools" class="hub-link">
          <span>üîß</span> Lottery Tools
        </a>
        <a href="/tools/probability-visualizer" class="hub-link">
          <span>üìâ</span> Probability Visualizer
        </a>
        <a href="/lottery-math" class="hub-link">
          <span>üßÆ</span> The Math
        </a>
      </div>
    </section>

    <!-- RNG Transparency Notice -->
    <div class="mt-8 p-4 rounded-xl text-xs" style="background: var(--surface); border: 1px solid var(--border-primary);">
      <div class="flex items-start gap-3">
        <span class="text-lg">üé≤</span>
        <div style="color: var(--text-secondary);">
          <strong style="color: var(--text-primary);">Fair & Transparent RNG</strong>
          <p class="mt-1">All games use <code class="px-1 py-0.5 rounded text-[10px]" style="background: var(--surface-elevated);">crypto.getRandomValues()</code> - a cryptographically secure random number generator built into your browser. This provides casino-grade randomness with no server-side manipulation. Each outcome is independent and unpredictable.</p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-8 pt-8 border-t border-[var(--border-primary)]">
      <!-- Footer Navigation -->
      <div class="grid gap-8 md:grid-cols-3 mb-8 text-sm">
        <div>
          <h4 class="font-semibold mb-3" style="color: var(--text-secondary);">Education</h4>
          <ul class="space-y-2" style="color: var(--text-muted);">
            <li><a href="/lottery-odds" class="hover:text-[var(--accent-primary)] transition-colors">Lottery Odds</a></li>
            <li><a href="/lottery-math" class="hover:text-[var(--accent-primary)] transition-colors">The Math</a></li>
            <li><a href="/faq" class="hover:text-[var(--accent-primary)] transition-colors">FAQ</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3" style="color: var(--text-secondary);">Tools</h4>
          <ul class="space-y-2" style="color: var(--text-muted);">
            <li><a href="/tools" class="hover:text-[var(--accent-primary)] transition-colors">All Tools</a></li>
            <li><a href="/casino-lite" class="hover:text-[var(--accent-primary)] transition-colors">Casino-Lite</a></li>
            <li><a href="/tools/payout-calculator" class="hover:text-[var(--accent-primary)] transition-colors">Payout Calculator</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3" style="color: var(--text-secondary);">Legal</h4>
          <ul class="space-y-2" style="color: var(--text-muted);">
            <li><a href="/terms" class="hover:text-[var(--accent-primary)] transition-colors">Terms & Conditions</a></li>
            <li><a href="/privacy" class="hover:text-[var(--accent-primary)] transition-colors">Privacy Policy</a></li>
          </ul>
        </div>
      </div>

      <!-- Copyright and branding -->
      <div class="text-center text-sm border-t border-[var(--border-primary)] pt-6" style="color: var(--text-muted);">
        <p>¬© 2025 MintLabs. All rights reserved.</p>
        <div class="mt-3 flex items-center justify-center gap-2 text-xs">
          <img src="/mintlab.png" alt="MintLabs" class="h-4 w-4 opacity-70" />
          <span>Powered by MintLabs</span>
        </div>
        <p class="mt-4 text-xs max-w-lg mx-auto" style="color: var(--text-muted);">
          For entertainment and education purposes only. Casino-Lite games use MintyCatnipCoin (MCC), a fictional currency with absolutely no real-world monetary value. We do not predict lottery numbers or casino outcomes. No real gambling occurs on this site. Play responsibly.
        </p>
        <p class="mt-3 text-xs">
          If you or someone you know has a gambling problem, visit
          <a href="https://www.ncpgambling.org" target="_blank" rel="noopener noreferrer" class="underline hover:text-[var(--accent-primary)]">ncpgambling.org</a>
          or call <strong>1-800-522-4700</strong>.
        </p>
      </div>
    </footer>
  </main>

  <!-- Custom Balance Modal -->
  <dialog id="customBalanceModal" class="modal-dialog">
    <div class="modal-content">
      <h3 class="text-lg font-semibold theme-text-primary mb-4">Set Custom Balance</h3>
      <div class="mb-4">
        <label for="customAmountInput" class="block text-sm theme-text-secondary mb-2">
          Enter amount (1 - 999,999)
        </label>
        <input
          type="number"
          id="customAmountInput"
          min="1"
          max="999999"
          value="1000"
          class="w-full px-3 py-2 rounded-lg border text-base"
          style="background: var(--surface); border-color: var(--border-primary); color: var(--text-primary);"
        />
      </div>
      <div class="flex gap-2 justify-end">
        <button id="cancelCustomBtn" class="px-4 py-2 rounded-lg text-sm" style="color: var(--text-muted);">
          Cancel
        </button>
        <button id="confirmCustomBtn" class="px-4 py-2 rounded-lg text-sm font-semibold" style="background: var(--accent-primary); color: var(--text-on-accent, #fff);">
          Set Balance
        </button>
      </div>
    </div>
  </dialog>
</Layout>

<style>
  /* Modal styles */
  .modal-dialog {
    border: none;
    border-radius: 0.75rem;
    padding: 0;
    background: var(--bg-card, #1e293b);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    max-width: 24rem;
    width: 90%;
  }

  .modal-dialog::backdrop {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    padding: 1.5rem;
  }

  /* Button hover states */
  #resetBalanceBtn:hover,
  #customBalanceBtn:hover {
    border-color: var(--accent-primary) !important;
    color: var(--accent-primary) !important;
  }
</style>

<script>
  import { getCatnipBalance, setCatnipBalance, CATNIP_INITIAL_BALANCE } from '../../utils/catnipCoin';

  // Update the constant to match the new value
  const STARTING_BALANCE = 1000;

  // DOM elements
  const balanceValue = document.getElementById('balanceValue');
  const resetBtn = document.getElementById('resetBalanceBtn');
  const customBtn = document.getElementById('customBalanceBtn');
  const modal = document.getElementById('customBalanceModal') as HTMLDialogElement;
  const customInput = document.getElementById('customAmountInput') as HTMLInputElement;
  const cancelBtn = document.getElementById('cancelCustomBtn');
  const confirmBtn = document.getElementById('confirmCustomBtn');

  // Update display
  function updateDisplay() {
    const balance = getCatnipBalance();
    if (balanceValue) {
      balanceValue.textContent = balance.toLocaleString();
    }
  }

  // Initialize
  updateDisplay();

  // Listen for balance changes from other pages/games
  window.addEventListener('catnipBalanceChange', () => updateDisplay());

  // Reset button
  resetBtn?.addEventListener('click', () => {
    setCatnipBalance(STARTING_BALANCE);
    updateDisplay();
  });

  // Custom balance button
  customBtn?.addEventListener('click', () => {
    customInput.value = getCatnipBalance().toString();
    modal?.showModal();
  });

  // Cancel modal
  cancelBtn?.addEventListener('click', () => modal?.close());

  // Close on backdrop click
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) modal.close();
  });

  // Confirm custom balance
  confirmBtn?.addEventListener('click', () => {
    const value = parseInt(customInput.value, 10);
    if (!isNaN(value) && value >= 1 && value <= 999999) {
      setCatnipBalance(value);
      updateDisplay();
      modal?.close();
    }
  });

  // Enter key in input
  customInput?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      confirmBtn?.click();
    }
  });
</script>
