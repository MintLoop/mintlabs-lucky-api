---
import InfoLayout from "../../components/InfoLayout.astro";
import TrackLink from "../../components/TrackLink.astro";

const title = "Raffle Picker | Random Name Selector";
const description = "Pick random winners from a list of names or items. Perfect for raffles, giveaways, team selection, and fair random draws.";
---

<InfoLayout title={title} description={description}>
  <div class="tool-container">
    <header class="tool-header">
      <h1>üéüÔ∏è Raffle Picker</h1>
      <p class="tool-tagline">Fair and transparent random selection</p>
    </header>

    <div class="tool-controls">
      <div class="control-section">
        <h3>üìù Enter Participants</h3>
        <p class="hint">One name per line. Duplicates will be kept (for weighted raffles).</p>
        <textarea
          id="participantInput"
          placeholder="Alice&#10;Bob&#10;Charlie&#10;Diana&#10;Eve"
          rows="12"
        ></textarea>
        <div class="input-stats">
          <span id="participantCount">0 participants</span>
        </div>
      </div>

      <div class="control-section">
        <label for="winnerCount">Number of Winners to Pick:</label>
        <input type="number" id="winnerCount" min="1" max="100" value="1" />
        <label class="checkbox-label">
          <input type="checkbox" id="allowDuplicates" />
          <span>Allow same winner multiple times</span>
        </label>
      </div>

      <button id="pickButton" class="action-button">
        üé≤ PICK WINNERS
      </button>

      <div class="quick-actions">
        <button id="clearButton" class="secondary-button">Clear All</button>
        <button id="sampleButton" class="secondary-button">Load Sample Data</button>
      </div>
    </div>

    <div id="resultsContainer" class="results-container" style="display: none;">
      <h2>üèÜ Winners</h2>
      <div id="winnersList" class="winners-list"></div>
      <div class="result-actions">
        <button id="copyButton" class="secondary-button">üìã Copy Results</button>
        <button id="pickAgainButton" class="secondary-button">üîÑ Pick Again</button>
      </div>
    </div>

    <section class="education-section">
      <h2>üìö How It Works</h2>
      <p>
        The Raffle Picker uses <strong>cryptographically secure random number generation</strong> 
        via <code>crypto.getRandomValues()</code> to ensure perfectly fair selection. 
        This is the same technology used by security-critical applications.
      </p>
      
      <div class="feature-grid">
        <div class="feature-card">
          <h3>üéØ True Randomness</h3>
          <p>Unlike pseudo-random algorithms, crypto RNG provides unpredictable results that cannot be gamed or manipulated.</p>
        </div>
        
        <div class="feature-card">
          <h3>‚öñÔ∏è Equal Probability</h3>
          <p>Every participant has exactly the same chance of being selected, regardless of position in the list.</p>
        </div>
        
        <div class="feature-card">
          <h3>üîÑ Duplicate Handling</h3>
          <p>Enable "allow duplicates" to pick the same winner multiple times (with replacement). Disable for unique winners only.</p>
        </div>
        
        <div class="feature-card">
          <h3>üí™ Weighted Raffles</h3>
          <p>Add a name multiple times to increase their chances. Perfect for ticket-based raffles where some participants have multiple entries.</p>
        </div>
      </div>

      <h3>Use Cases</h3>
      <ul>
        <li>üéâ Giveaways and contests</li>
        <li>üèÜ Prize drawings and raffles</li>
        <li>üë• Team or group selection</li>
        <li>üìä Random sampling for surveys</li>
        <li>üéÆ Tournament bracket seeding</li>
        <li>üéÅ Secret Santa assignments</li>
      </ul>
    </section>

    <section class="related-tools">
      <h3>Related Tools</h3>
      <div class="tool-links">
        <TrackLink href="/casino-lite" eventName="casino_lite_hub_link">
          üé∞ Casino-Lite Hub
        </TrackLink>
        <TrackLink href="/tools/wheel-spinner" eventName="wheel_spinner_link">
          Wheel Spinner
        </TrackLink>
        <TrackLink href="/tools/dice-roller" eventName="dice_roller_link">
          Dice Roller
        </TrackLink>
        <TrackLink href="/tools/card-picker" eventName="card_picker_link">
          Card Picker
        </TrackLink>
        <TrackLink href="/" eventName="home_link">
          Lucky Number Generator
        </TrackLink>
      </div>
    </section>
  </div>
</InfoLayout>

<style>
  .tool-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .tool-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .tool-header h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .tool-tagline {
    color: var(--text-secondary);
    font-size: 1.1rem;
  }

  .tool-controls {
    background: var(--surface-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
  }

  .control-section {
    margin-bottom: 1.5rem;
  }

  .control-section h3 {
    margin-top: 0;
    margin-bottom: 0.5rem;
  }

  .hint {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
  }

  textarea {
    width: 100%;
    padding: 1rem;
    font-size: 1rem;
    font-family: monospace;
    border: 2px solid var(--border-primary);
    border-radius: 0.5rem;
    background: var(--input-bg);
    color: var(--text-primary);
    resize: vertical;
    min-height: 200px;
  }

  .input-stats {
    margin-top: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.9rem;
  }

  .control-section label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .control-section input[type="number"] {
    width: 100%;
    max-width: 200px;
    padding: 0.75rem;
    font-size: 1rem;
    border: 2px solid var(--border-primary);
    border-radius: 0.5rem;
    background: var(--input-bg);
    color: var(--text-primary);
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
    font-weight: normal;
    cursor: pointer;
  }

  .checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  .action-button {
    width: 100%;
    padding: 1rem 2rem;
    font-size: 1.2rem;
    font-weight: bold;
    background: var(--accent-primary);
    color: white;
    border: none;
    border-radius: 0.75rem;
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 1rem;
  }

  .action-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .action-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .quick-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .secondary-button {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    background: var(--surface);
    color: var(--text-primary);
    border: 2px solid var(--border-primary);
    border-radius: 0.75rem;
    cursor: pointer;
    transition: all 0.3s;
  }

  .secondary-button:hover {
    background: var(--surface-elevated);
    transform: translateY(-2px);
  }

  .results-container {
    background: var(--surface-elevated);
    border: 2px solid var(--accent-primary);
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
    animation: fadeIn 0.5s;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .results-container h2 {
    margin-top: 0;
    text-align: center;
  }

  .winners-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin: 2rem 0;
  }

  .winner-card {
    background: var(--surface);
    border: 2px solid var(--border-primary);
    border-radius: 0.75rem;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    animation: slideIn 0.5s;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .winner-rank {
    font-size: 2rem;
    font-weight: bold;
    color: var(--accent-primary);
    min-width: 60px;
    text-align: center;
  }

  .winner-name {
    flex: 1;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .result-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .education-section {
    background: var(--surface-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
  }

  .education-section h2 {
    margin-top: 0;
  }

  .education-section p {
    line-height: 1.6;
    color: var(--text-secondary);
  }

  .education-section code {
    background: var(--surface);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-family: monospace;
    color: var(--accent-primary);
  }

  .feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
  }

  .feature-card {
    background: var(--surface);
    border: 1px solid var(--border-primary);
    border-radius: 0.75rem;
    padding: 1.5rem;
  }

  .feature-card h3 {
    margin-top: 0;
    margin-bottom: 0.75rem;
    color: var(--accent-primary);
  }

  .feature-card p {
    margin: 0;
    color: var(--text-secondary);
    line-height: 1.5;
  }

  .education-section ul {
    columns: 2;
    column-gap: 2rem;
    list-style-position: inside;
    color: var(--text-secondary);
  }

  .education-section li {
    margin-bottom: 0.5rem;
  }

  .related-tools {
    margin-top: 3rem;
  }

  .tool-links {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1rem;
  }

  .tool-links a {
    padding: 0.75rem 1.5rem;
    background: var(--surface-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
    text-decoration: none;
    color: var(--text-primary);
    transition: all 0.3s;
  }

  .tool-links a:hover {
    background: var(--accent-primary);
    color: white;
    transform: translateY(-2px);
  }

  @media (max-width: 768px) {
    .tool-header h1 {
      font-size: 2rem;
    }

    .quick-actions {
      grid-template-columns: 1fr;
    }

    .result-actions {
      grid-template-columns: 1fr;
    }

    .education-section ul {
      columns: 1;
    }

    .winner-name {
      font-size: 1.2rem;
    }

    .winner-rank {
      font-size: 1.5rem;
      min-width: 50px;
    }
  }
</style>

<script>
  const SAMPLE_DATA = `Alice Johnson
Bob Smith
Charlie Davis
Diana Prince
Eve Anderson
Frank Miller
Grace Lee
Henry Wilson
Iris Chen
Jack Brown`;

  let participants: string[] = [];

  function updateParticipantCount() {
    const textarea = document.getElementById('participantInput') as HTMLTextAreaElement;
    const text = textarea.value.trim();
    participants = text ? text.split('\n').map(p => p.trim()).filter(p => p) : [];
    
    const countSpan = document.getElementById('participantCount');
    if (countSpan) {
      countSpan.textContent = `${participants.length} participant${participants.length !== 1 ? 's' : ''}`;
    }

    const pickButton = document.getElementById('pickButton') as HTMLButtonElement;
    if (pickButton) {
      pickButton.disabled = participants.length === 0;
    }
  }

  function pickWinners() {
    if (participants.length === 0) return;

    const winnerCountInput = document.getElementById('winnerCount') as HTMLInputElement;
    const allowDuplicatesCheckbox = document.getElementById('allowDuplicates') as HTMLInputElement;
    
    const winnerCount = Math.min(
      parseInt(winnerCountInput.value),
      allowDuplicatesCheckbox.checked ? 100 : participants.length
    );

    const winners: string[] = [];
    const availableParticipants = [...participants];

    for (let i = 0; i < winnerCount; i++) {
      const pool = allowDuplicatesCheckbox.checked ? participants : availableParticipants;
      if (pool.length === 0) break;

      // Use crypto RNG for true randomness
      const randomArray = new Uint32Array(1);
      crypto.getRandomValues(randomArray);
      const randomIndex = randomArray[0] % pool.length;
      
      winners.push(pool[randomIndex]);
      
      if (!allowDuplicatesCheckbox.checked) {
        availableParticipants.splice(randomIndex, 1);
      }
    }

    displayWinners(winners);
  }

  function displayWinners(winners: string[]) {
    const container = document.getElementById('resultsContainer');
    const winnersList = document.getElementById('winnersList');
    
    if (!container || !winnersList) return;

    winnersList.innerHTML = '';
    
    winners.forEach((winner, index) => {
      const card = document.createElement('div');
      card.className = 'winner-card';
      card.style.animationDelay = `${index * 0.1}s`;

      const rank = document.createElement('div');
      rank.className = 'winner-rank';
      rank.textContent = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`;

      const name = document.createElement('div');
      name.className = 'winner-name';
      name.textContent = winner;

      card.appendChild(rank);
      card.appendChild(name);
      winnersList.appendChild(card);
    });

    container.style.display = 'block';
    container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }

  function copyResults() {
    const winnerCards = document.querySelectorAll('.winner-name');
    const winners = Array.from(winnerCards).map(card => card.textContent).join('\n');
    
    navigator.clipboard.writeText(winners).then(() => {
      const copyButton = document.getElementById('copyButton');
      if (copyButton) {
        const originalText = copyButton.textContent;
        copyButton.textContent = '‚úÖ Copied!';
        setTimeout(() => {
          copyButton.textContent = originalText;
        }, 2000);
      }
    });
  }

  function loadSampleData() {
    const textarea = document.getElementById('participantInput') as HTMLTextAreaElement;
    textarea.value = SAMPLE_DATA;
    updateParticipantCount();
  }

  function clearAll() {
    const textarea = document.getElementById('participantInput') as HTMLTextAreaElement;
    textarea.value = '';
    updateParticipantCount();
    
    const resultsContainer = document.getElementById('resultsContainer');
    if (resultsContainer) {
      resultsContainer.style.display = 'none';
    }
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    const textarea = document.getElementById('participantInput') as HTMLTextAreaElement;
    textarea.addEventListener('input', updateParticipantCount);

    document.getElementById('pickButton')?.addEventListener('click', pickWinners);
    document.getElementById('copyButton')?.addEventListener('click', copyResults);
    document.getElementById('pickAgainButton')?.addEventListener('click', pickWinners);
    document.getElementById('sampleButton')?.addEventListener('click', loadSampleData);
    document.getElementById('clearButton')?.addEventListener('click', clearAll);

    updateParticipantCount();
  });
</script>
</InfoLayout>
