---
import InfoLayout from "../../components/InfoLayout.astro";

const pageTitle = "Random Color Generator | Hex Color Picker with Meanings";
const description = "Generate random colors with hex codes, RGB values, and color meanings. Discover color psychology and symbolism with each random color.";
const keywords = "random color generator, hex color picker, color meanings, color psychology, random hex";

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Random Color Generator",
  "description": description,
  "applicationCategory": "Utility Tool",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  }
};

// Color meanings database handled by getColorMeaning(hue) helper function
---

<InfoLayout
  title="ðŸŽ¨ Random Color Generator"
  subtitle="Generate random colors with meanings"
  pageTitle={pageTitle}
  description={description}
  keywords={keywords}
  jsonLd={jsonLd}
>
  <div slot="teaser" class="teaser-content">
    <p>
      Generate random colors and discover their psychological meanings and symbolism.
      <strong>Fun fact:</strong> There are 16,777,216 possible colors in standard RGB
      (256 Ã— 256 Ã— 256 combinations)!
    </p>
  </div>

  <section class="tool-section">
    <div class="color-generator">
      <div id="colorDisplay" class="color-display">
        <div class="color-info-grid">
          <div class="info-row">
            <span class="info-label">HEX:</span>
            <span id="hexValue" class="info-value">#000000</span>
            <button id="copyHex" class="copy-btn" aria-label="Copy hex code">ðŸ“‹</button>
          </div>
          <div class="info-row">
            <span class="info-label">RGB:</span>
            <span id="rgbValue" class="info-value">rgb(0, 0, 0)</span>
            <button id="copyRgb" class="copy-btn" aria-label="Copy RGB value">ðŸ“‹</button>
          </div>
          <div class="info-row">
            <span class="info-label">HSL:</span>
            <span id="hslValue" class="info-value">hsl(0, 0%, 0%)</span>
            <button id="copyHsl" class="copy-btn" aria-label="Copy HSL value">ðŸ“‹</button>
          </div>
        </div>

        <div id="meaning" class="meaning-display">
          <h4>Color Psychology</h4>
          <p id="meaningText"></p>
        </div>
      </div>

      <button id="generateBtn" class="generate-btn">
        ðŸŽ¨ Generate Random Color
      </button>

      <div class="options-section">
        <h4>Generator Options</h4>
        <div class="options-grid">
          <label class="option-label">
            <input type="radio" name="colorType" value="any" checked />
            Any color
          </label>
          <label class="option-label">
            <input type="radio" name="colorType" value="vibrant" />
            Vibrant colors
          </label>
          <label class="option-label">
            <input type="radio" name="colorType" value="pastel" />
            Pastel colors
          </label>
          <label class="option-label">
            <input type="radio" name="colorType" value="dark" />
            Dark colors
          </label>
        </div>
      </div>
    </div>

    <div id="history" class="history-section" hidden>
      <div class="history-header">
        <h3>Color History</h3>
        <button id="clearHistory" class="text-btn">Clear</button>
      </div>
      <div id="historyGrid" class="history-grid"></div>
    </div>
  </section>

  <section class="info-section">
    <h3>About Color Generation</h3>
    <p>
      This tool generates random colors across the entire RGB color space. Each color
      is represented in three common formats: HEX (hexadecimal), RGB (red-green-blue),
      and HSL (hue-saturation-lightness).
    </p>

    <h4>Color Formats Explained</h4>
    <ul>
      <li><strong>HEX:</strong> 6-digit hexadecimal code (#RRGGBB), commonly used in web design</li>
      <li><strong>RGB:</strong> Three values (0-255) for red, green, and blue channels</li>
      <li><strong>HSL:</strong> Hue (0-360Â°), Saturation (0-100%), Lightness (0-100%)</li>
    </ul>

    <h4>Color Psychology</h4>
    <p>
      Colors can influence mood, perception, and behavior. While responses vary by culture
      and personal experience, certain color associations are widely recognized:
    </p>
    <ul>
      <li><strong>Red:</strong> Stimulating, energizing, associated with passion and urgency</li>
      <li><strong>Blue:</strong> Calming, trustworthy, associated with stability and peace</li>
      <li><strong>Green:</strong> Balanced, natural, associated with growth and health</li>
      <li><strong>Yellow:</strong> Cheerful, attention-grabbing, associated with optimism</li>
      <li><strong>Purple:</strong> Creative, luxurious, associated with spirituality and royalty</li>
    </ul>

    <h4>Uses for Random Colors</h4>
    <ul>
      <li>Design inspiration and color palette creation</li>
      <li>Testing color contrast and accessibility</li>
      <li>Art projects and creative exercises</li>
      <li>Learning about color theory and psychology</li>
    </ul>
  </section>
</InfoLayout>

<style>
  .color-generator {
    padding: 1.5rem;
    background: var(--surface-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
    box-shadow: var(--card-shadow);
  }

  .color-display {
    min-height: 300px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    border: 4px solid var(--border-primary-darker);
    border-radius: 0.5rem;
    transition: background-color 0.3s ease;
    animation: colorFade 0.3s ease;
  }

  @keyframes colorFade {
    from { opacity: 0.7; }
    to { opacity: 1; }
  }

  .color-info-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .info-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 1rem;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    border-radius: 0.5rem;
  }

  .info-label {
    font-weight: 700;
    min-width: 50px;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  .info-value {
    flex: 1;
    font-family: 'Courier New', monospace;
    font-size: 1.125rem;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  .copy-btn {
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.2s;
    backdrop-filter: blur(10px);
  }

  .copy-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
  }

  .meaning-display {
    padding: 1.5rem;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    border-radius: 0.5rem;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  .meaning-display h4 {
    margin: 0 0 0.5rem;
    font-size: 1.125rem;
  }

  .meaning-display p {
    margin: 0;
    line-height: 1.6;
  }

  .generate-btn {
    width: 100%;
    padding: 1rem 2rem;
    background: var(--accent);
    color: var(--accent-foreground);
    border: none;
    border-radius: 0.5rem;
    font-size: 1.25rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .generate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
  }

  .options-section {
    margin-top: 1.5rem;
    padding: 1rem;
    background: var(--surface);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
  }

  .options-section h4 {
    margin: 0 0 0.75rem;
    font-size: 1rem;
  }

  .options-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 0.5rem;
  }

  .option-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    cursor: pointer;
  }

  .option-label input[type="radio"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  .history-section {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--surface-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
    box-shadow: var(--card-shadow);
  }

  .history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .history-header h3 {
    margin: 0;
  }

  .text-btn {
    background: none;
    border: none;
    color: var(--accent);
    text-decoration: underline;
    cursor: pointer;
    font-size: 0.875rem;
    padding: 0.25rem 0.5rem;
  }

  .history-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 0.75rem;
  }

  .history-color {
    aspect-ratio: 1;
    border: 2px solid var(--border-primary);
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }

  .history-color:hover {
    transform: scale(1.1);
    box-shadow: var(--card-shadow);
  }

  .history-color::after {
    content: attr(data-hex);
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.625rem;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .history-color:hover::after {
    opacity: 1;
  }

  .info-section {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--surface);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
  }

  .info-section h3 {
    margin-top: 0;
  }

  .info-section h4 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .info-section ul {
    margin-left: 1.5rem;
  }

  .info-section li {
    margin-bottom: 0.5rem;
  }

  @media (max-width: 640px) {
    .color-display {
      min-height: 250px;
      padding: 1.5rem;
    }

    .options-grid {
      grid-template-columns: 1fr;
    }

    .history-grid {
      grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
    }
  }
</style>

<script>
  const colorDisplay = document.getElementById('colorDisplay')!;
  const hexValue = document.getElementById('hexValue')!;
  const rgbValue = document.getElementById('rgbValue')!;
  const hslValue = document.getElementById('hslValue')!;
  const meaningText = document.getElementById('meaningText')!;
  const generateBtn = document.getElementById('generateBtn')!;
  const copyHex = document.getElementById('copyHex')!;
  const copyRgb = document.getElementById('copyRgb')!;
  const copyHsl = document.getElementById('copyHsl')!;
  const historySection = document.getElementById('history')!;
  const historyGrid = document.getElementById('historyGrid')!;
  const clearHistory = document.getElementById('clearHistory')!;

  let colorHistory: string[] = [];

  function rgbToHsl(r: number, g: number, b: number): [number, number, number] {
    r /= 255;
    g /= 255;
    b /= 255;
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h = 0, s = 0, l = (max + min) / 2;

    if (max !== min) {
      const d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      
      switch (max) {
        case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
        case g: h = ((b - r) / d + 2) / 6; break;
        case b: h = ((r - g) / d + 4) / 6; break;
      }
    }

    return [Math.round(h * 360), Math.round(s * 100), Math.round(l * 100)];
  }

  function getColorMeaning(hue: number): string {
    if ((hue >= 0 && hue < 30) || hue >= 330) return "Passion, energy, excitement, and strength";
    if (hue >= 30 && hue < 60) return "Creativity, enthusiasm, warmth, and adventure";
    if (hue >= 60 && hue < 90) return "Joy, optimism, intelligence, and clarity";
    if (hue >= 90 && hue < 150) return "Growth, harmony, balance, and renewal";
    if (hue >= 150 && hue < 210) return "Calm, clarity, communication, and freshness";
    if (hue >= 210 && hue < 270) return "Trust, stability, wisdom, and serenity";
    if (hue >= 270 && hue < 330) return "Creativity, spirituality, luxury, and mystery";
    return "Neutral, balanced, versatile";
  }

  function generateColor() {
    const colorType = (document.querySelector('input[name="colorType"]:checked') as HTMLInputElement)?.value || 'any';
    
    let r, g, b;
    
    switch (colorType) {
      case 'vibrant':
        // High saturation colors
        r = Math.floor(Math.random() * 256);
        g = Math.floor(Math.random() * 256);
        b = Math.floor(Math.random() * 256);
        // Boost the dominant channel
        const max = Math.max(r, g, b);
        if (r === max) r = Math.min(255, r + 50);
        else if (g === max) g = Math.min(255, g + 50);
        else b = Math.min(255, b + 50);
        break;
      
      case 'pastel':
        // Light, soft colors
        r = Math.floor(Math.random() * 100 + 155);
        g = Math.floor(Math.random() * 100 + 155);
        b = Math.floor(Math.random() * 100 + 155);
        break;
      
      case 'dark':
        // Dark colors
        r = Math.floor(Math.random() * 100);
        g = Math.floor(Math.random() * 100);
        b = Math.floor(Math.random() * 100);
        break;
      
      default:
        // Any color
        r = Math.floor(Math.random() * 256);
        g = Math.floor(Math.random() * 256);
        b = Math.floor(Math.random() * 256);
    }

    const hex = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`.toUpperCase();
    const rgb = `rgb(${r}, ${g}, ${b})`;
    const [h, s, l] = rgbToHsl(r, g, b);
    const hsl = `hsl(${h}, ${s}%, ${l}%)`;

    colorDisplay.style.backgroundColor = hex;
    hexValue.textContent = hex;
    rgbValue.textContent = rgb;
    hslValue.textContent = hsl;
    meaningText.textContent = getColorMeaning(h);

    // Add to history
    if (!colorHistory.includes(hex)) {
      colorHistory.unshift(hex);
      if (colorHistory.length > 20) colorHistory.pop();
      renderHistory();
    }
  }

  function renderHistory() {
    if (colorHistory.length === 0) {
      historySection.hidden = true;
      return;
    }

    historySection.hidden = false;
    historyGrid.innerHTML = colorHistory.map(hex => `
      <div class="history-color" style="background: ${hex}" data-hex="${hex}" title="${hex}"></div>
    `).join('');

    // Add click handlers
    document.querySelectorAll('.history-color').forEach(el => {
      el.addEventListener('click', () => {
        const hex = (el as HTMLElement).dataset.hex!;
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        const [h, s, l] = rgbToHsl(r, g, b);

        colorDisplay.style.backgroundColor = hex;
        hexValue.textContent = hex;
        rgbValue.textContent = `rgb(${r}, ${g}, ${b})`;
        hslValue.textContent = `hsl(${h}, ${s}%, ${l}%)`;
        meaningText.textContent = getColorMeaning(h);
      });
    });
  }

  async function copyToClipboard(text: string) {
    try {
      await navigator.clipboard.writeText(text);
      // Visual feedback would go here
    } catch (err) {
      console.error('Copy failed:', err);
    }
  }

  generateBtn.addEventListener('click', generateColor);
  copyHex.addEventListener('click', () => copyToClipboard(hexValue.textContent!));
  copyRgb.addEventListener('click', () => copyToClipboard(rgbValue.textContent!));
  copyHsl.addEventListener('click', () => copyToClipboard(hslValue.textContent!));
  clearHistory.addEventListener('click', () => {
    colorHistory = [];
    renderHistory();
  });

  // Generate initial color
  generateColor();
</script>
