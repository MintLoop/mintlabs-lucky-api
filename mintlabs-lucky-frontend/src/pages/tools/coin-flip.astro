---
import InfoLayout from "../../components/InfoLayout.astro";

const pageTitle = "Coin Flip Simulator | Fair Digital Coin Toss";
const description = "Flip a fair digital coin with instant results. Track heads/tails streaks and total flip statistics. Perfect for making decisions or probability experiments.";
const keywords = "coin flip, coin toss, heads or tails, random coin flip, decision maker";

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Coin Flip Simulator",
  "description": description,
  "applicationCategory": "Utility Tool",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  }
};
---

<InfoLayout
  title="ðŸª™ Coin Flip"
  subtitle="Flip a fair digital coin"
  pageTitle={pageTitle}
  description={description}
  keywords={keywords}
  jsonLd={jsonLd}
>
  <div slot="teaser" class="teaser-content">
    <p>
      Flip a perfectly fair digital coin with exactly 50/50 odds for heads or tails.
      <strong>Fun fact:</strong> Even if you flip heads 10 times in a row, the next flip still
      has a 50% chance of being headsâ€”that's the gambler's fallacy in action!
    </p>
  </div>

  <section class="tool-section">
    <div class="coin-flipper">
      <div class="coin-container">
        <div id="coin" class="coin" role="img" aria-label="Coin showing heads">
          <div class="coin-face heads">
            <span class="coin-emoji">ðŸ‘‘</span>
            <span class="coin-label">HEADS</span>
          </div>
          <div class="coin-face tails">
            <span class="coin-emoji">ðŸ¦…</span>
            <span class="coin-label">TAILS</span>
          </div>
        </div>
      </div>

      <button id="flipBtn" class="flip-btn">
        ðŸª™ Flip Coin
      </button>

      <div id="result" class="result-display" hidden>
        <span id="resultText" class="result-text"></span>
      </div>
    </div>

    <div class="stats-container">
      <h3>Statistics</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-label">Total Flips</span>
          <span id="totalFlips" class="stat-value">0</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Heads</span>
          <span id="headsCount" class="stat-value">0</span>
          <span id="headsPercent" class="stat-percent">0%</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Tails</span>
          <span id="tailsCount" class="stat-value">0</span>
          <span id="tailsPercent" class="stat-percent">0%</span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Current Streak</span>
          <span id="currentStreak" class="stat-value">0</span>
          <span id="streakType" class="stat-subtitle"></span>
        </div>
        <div class="stat-card">
          <span class="stat-label">Longest Streak</span>
          <span id="longestStreak" class="stat-value">0</span>
          <span id="longestType" class="stat-subtitle"></span>
        </div>
      </div>

      <button id="resetBtn" class="reset-btn">
        Reset Statistics
      </button>
    </div>
  </section>

  <section class="info-section">
    <h3>About Coin Flips</h3>
    <p>
      A coin flip is one of the simplest forms of randomization with exactly two equally likely outcomes.
      Each flip is independent, meaning previous results don't affect future flips.
    </p>

    <h4>Probability</h4>
    <p>
      Every flip has a <strong>50% chance</strong> of landing on heads and a <strong>50% chance</strong>
      of landing on tails, regardless of previous results. The probability remains constant:
    </p>
    <ul>
      <li>P(Heads) = 1/2 = 0.5 = 50%</li>
      <li>P(Tails) = 1/2 = 0.5 = 50%</li>
      <li>P(Same result twice) = 1/4 = 0.25 = 25%</li>
      <li>P(Same result 10 times) = (1/2)^10 â‰ˆ 0.098%</li>
    </ul>

    <h4>The Gambler's Fallacy</h4>
    <p>
      Many people incorrectly believe that after several heads in a row, tails is "due" to appear.
      This is false! Each flip is independent, and the coin has no memory of previous results.
      A streak of 10 heads doesn't make tails any more likely on flip #11.
    </p>

    <h4>Law of Large Numbers</h4>
    <p>
      While each individual flip is unpredictable, over many flips the ratio of heads to tails
      will approach 50/50. Try flipping 100 times to see this principle in action!
    </p>
  </section>
</InfoLayout>

<style>
  .coin-flipper {
    padding: 2rem;
    background: var(--surface-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
    box-shadow: var(--card-shadow);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
  }

  .coin-container {
    perspective: 1000px;
    width: 200px;
    height: 200px;
  }

  .coin {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease-in-out;
  }

  .coin.flipping {
    animation: coinFlip 0.6s ease-in-out;
  }

  @keyframes coinFlip {
    0% { transform: rotateY(0deg); }
    100% { transform: rotateY(1080deg); }
  }

  .coin.show-tails {
    transform: rotateY(180deg);
  }

  .coin-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    background: var(--surface);
    border: 4px solid var(--border-primary-darker);
    border-radius: 50%;
    box-shadow: var(--card-shadow),
                inset 0 0 20px rgba(0, 0, 0, 0.1);
  }

  .coin-face.heads {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
    border-color: #d4af37;
  }

  .coin-face.tails {
    background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 50%, #c0c0c0 100%);
    border-color: #a0a0a0;
    transform: rotateY(180deg);
  }

  .coin-emoji {
    font-size: 4rem;
    line-height: 1;
    filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.2));
  }

  .coin-label {
    font-size: 1.25rem;
    font-weight: 700;
    color: #333;
    text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
  }

  .flip-btn {
    padding: 1rem 3rem;
    background: var(--accent);
    color: var(--accent-foreground);
    border: none;
    border-radius: 0.5rem;
    font-size: 1.25rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .flip-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
  }

  .flip-btn:active:not(:disabled) {
    transform: translateY(0);
  }

  .flip-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .result-display {
    padding: 1rem 2rem;
    background: var(--surface);
    border: 2px solid var(--border-primary-darker);
    border-radius: 0.5rem;
    animation: resultFadeIn 0.3s ease;
  }

  @keyframes resultFadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .result-text {
    font-size: 1.5rem;
    font-weight: 700;
  }

  .stats-container {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--surface-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
    box-shadow: var(--card-shadow);
  }

  .stats-container h3 {
    margin-top: 0;
    margin-bottom: 1rem;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .stat-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    background: var(--surface);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
  }

  .stat-label {
    font-size: 0.875rem;
    opacity: 0.8;
    text-align: center;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1;
  }

  .stat-percent,
  .stat-subtitle {
    font-size: 0.875rem;
    opacity: 0.7;
  }

  .reset-btn {
    width: 100%;
    padding: 0.75rem;
    background: var(--surface);
    border: 2px solid var(--border-primary);
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .reset-btn:hover {
    background: var(--surface-hover);
  }

  .info-section {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--surface);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
  }

  .info-section h3 {
    margin-top: 0;
  }

  .info-section h4 {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .info-section ul {
    margin-left: 1.5rem;
  }

  .info-section li {
    margin-bottom: 0.5rem;
  }

  @media (max-width: 640px) {
    .coin-container {
      width: 150px;
      height: 150px;
    }

    .coin-emoji {
      font-size: 3rem;
    }

    .coin-label {
      font-size: 1rem;
    }

    .flip-btn {
      padding: 0.75rem 2rem;
      font-size: 1rem;
    }

    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>

<script>
  // State
  let totalFlips = 0;
  let headsCount = 0;
  let tailsCount = 0;
  let currentStreak = 0;
  let currentStreakType: 'heads' | 'tails' | null = null;
  let longestStreak = 0;
  let longestStreakType: 'heads' | 'tails' | null = null;

  // DOM elements
  const coin = document.getElementById('coin')!;
  const flipBtn = document.getElementById('flipBtn') as HTMLButtonElement;
  const resetBtn = document.getElementById('resetBtn')!;
  const resultDisplay = document.getElementById('result')!;
  const resultText = document.getElementById('resultText')!;

  // Stat elements
  const totalFlipsEl = document.getElementById('totalFlips')!;
  const headsCountEl = document.getElementById('headsCount')!;
  const headsPercentEl = document.getElementById('headsPercent')!;
  const tailsCountEl = document.getElementById('tailsCount')!;
  const tailsPercentEl = document.getElementById('tailsPercent')!;
  const currentStreakEl = document.getElementById('currentStreak')!;
  const streakTypeEl = document.getElementById('streakType')!;
  const longestStreakEl = document.getElementById('longestStreak')!;
  const longestTypeEl = document.getElementById('longestType')!;

  // Flip coin
  flipBtn.addEventListener('click', flipCoin);

  function flipCoin() {
    // Disable button during flip
    flipBtn.disabled = true;

    // Remove previous result classes
    coin.classList.remove('show-tails');
    
    // Add flipping animation
    coin.classList.add('flipping');

    // Determine result (true = heads, false = tails)
    const isHeads = Math.random() < 0.5;

    // Wait for animation to complete
    setTimeout(() => {
      // Update coin display
      if (!isHeads) {
        coin.classList.add('show-tails');
      }

      // Update stats
      totalFlips++;
      if (isHeads) {
        headsCount++;
      } else {
        tailsCount++;
      }

      // Update streak
      if (currentStreakType === (isHeads ? 'heads' : 'tails')) {
        currentStreak++;
      } else {
        currentStreak = 1;
        currentStreakType = isHeads ? 'heads' : 'tails';
      }

      // Update longest streak
      if (currentStreak > longestStreak) {
        longestStreak = currentStreak;
        longestStreakType = currentStreakType;
      }

      // Show result
      resultText.textContent = isHeads ? 'ðŸ‘‘ HEADS!' : 'ðŸ¦… TAILS!';
      resultDisplay.hidden = false;

      // Update stats display
      updateStatsDisplay();

      // Remove flipping animation
      coin.classList.remove('flipping');

      // Re-enable button
      flipBtn.disabled = false;
    }, 600);
  }

  function updateStatsDisplay() {
    totalFlipsEl.textContent = totalFlips.toString();
    headsCountEl.textContent = headsCount.toString();
    tailsCountEl.textContent = tailsCount.toString();

    const headsPercent = totalFlips > 0 ? (headsCount / totalFlips * 100).toFixed(1) : '0';
    const tailsPercent = totalFlips > 0 ? (tailsCount / totalFlips * 100).toFixed(1) : '0';
    headsPercentEl.textContent = `${headsPercent}%`;
    tailsPercentEl.textContent = `${tailsPercent}%`;

    currentStreakEl.textContent = currentStreak.toString();
    streakTypeEl.textContent = currentStreakType ? currentStreakType : '';

    longestStreakEl.textContent = longestStreak.toString();
    longestTypeEl.textContent = longestStreakType ? longestStreakType : '';
  }

  // Reset stats
  resetBtn.addEventListener('click', () => {
    if (confirm('Reset all statistics? This cannot be undone.')) {
      totalFlips = 0;
      headsCount = 0;
      tailsCount = 0;
      currentStreak = 0;
      currentStreakType = null;
      longestStreak = 0;
      longestStreakType = null;
      updateStatsDisplay();
      resultDisplay.hidden = true;
      coin.classList.remove('show-tails');
    }
  });
</script>
